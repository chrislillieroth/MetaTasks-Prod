{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MetaTasks - Workflow and Resource Management Platform">
    <title>{% block title %}MetaTasks{% endblock %}</title>
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/cdn.min.js"></script>
    
    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#3b82f6" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#111827" media="(prefers-color-scheme: dark)">
    
    {% block extra_head %}{% endblock %}
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 transition-colors" 
      x-data="{ 
          sidebarOpen: false,
          darkMode: localStorage.getItem('darkMode') === 'true' || (!('darkMode' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)
      }"
      x-init="$watch('darkMode', val => {
          localStorage.setItem('darkMode', val);
          if (val) {
              document.documentElement.classList.add('dark');
          } else {
              document.documentElement.classList.remove('dark');
          }
      });
      if (darkMode) {
          document.documentElement.classList.add('dark');
      }"
>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">
        Skip to main content
    </a>

    <!-- Toast notification container -->
    <div id="toast-container" 
         class="fixed top-4 right-4 z-[1080] space-y-2" 
         aria-live="polite" 
         role="status">
        <!-- Toasts will be inserted here dynamically -->
    </div>

    <!-- Main application shell -->
    <div class="min-h-full">
        {% block sidebar %}
        <!-- Sidebar for desktop -->
        <div class="hidden lg:flex lg:w-64 lg:flex-col lg:fixed lg:inset-y-0 lg:z-50">
            {% include 'ui/partials/navigation/sidebar.html' %}
        </div>

        <!-- Mobile sidebar overlay -->
        <div x-show="sidebarOpen" 
             x-transition:enter="transition-opacity ease-linear duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition-opacity ease-linear duration-300"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 flex z-40 lg:hidden"
             @click.self="sidebarOpen = false">
            
            <!-- Overlay backdrop -->
            <div class="fixed inset-0 bg-gray-600 bg-opacity-75"></div>
            
            <!-- Sidebar panel -->
            <div x-show="sidebarOpen"
                 x-transition:enter="transition ease-in-out duration-300 transform"
                 x-transition:enter-start="-translate-x-full"
                 x-transition:enter-end="translate-x-0"
                 x-transition:leave="transition ease-in-out duration-300 transform"
                 x-transition:leave-start="translate-x-0"
                 x-transition:leave-end="-translate-x-full"
                 class="relative flex-1 flex flex-col max-w-xs w-full bg-white dark:bg-gray-800">
                {% include 'ui/partials/navigation/sidebar.html' with mobile=True %}
            </div>
        </div>
        {% endblock %}

        <!-- Main content area -->
        <div class="lg:pl-64 flex flex-col flex-1">
            {% block topbar %}
            {% include 'ui/partials/navigation/topbar.html' %}
            {% endblock %}

            <!-- Page content -->
            <main id="main-content" class="flex-1">
                {% block messages %}
                {% if messages %}
                <div class="px-4 sm:px-6 lg:px-8 py-4">
                    {% for message in messages %}
                    <div class="rounded-md p-4 mb-4 {% if message.tags == 'error' %}bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-200{% elif message.tags == 'success' %}bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-200{% elif message.tags == 'warning' %}bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200{% else %}bg-blue-50 dark:bg-blue-900/20 text-blue-800 dark:text-blue-200{% endif %}"
                         role="alert">
                        <p class="text-sm font-medium">{{ message }}</p>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                {% endblock %}

                <div class="px-4 sm:px-6 lg:px-8 py-8">
                    {% block content %}
                    {% endblock %}
                </div>
            </main>

            {% block footer %}
            <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                <div class="px-4 sm:px-6 lg:px-8 py-4">
                    <p class="text-sm text-gray-500 dark:text-gray-400 text-center">
                        Â© {% now "Y" %} MetaTasks. All rights reserved.
                    </p>
                </div>
            </footer>
            {% endblock %}
        </div>
    </div>

    {% block extra_scripts %}{% endblock %}
</body>
</html>
